"use strict";!function(a){"object"==typeof exports?module.exports=a():"function"==typeof define&&define.amd?define(a):(window.WatchJS=a(),window.watch=window.WatchJS.watch,window.unwatch=window.WatchJS.unwatch,window.callWatchers=window.WatchJS.callWatchers)}(function(){var a={noMore:!1},b=[],c=function(a){var b={};return a&&"[object Function]"==b.toString.call(a)},d=function(a){return 0===a%1},e=function(a){return"[object Array]"===Object.prototype.toString.call(a)},f=function(a,b){var c=[],d=[];if("string"!=typeof a&&"string"!=typeof b&&!e(a)&&!e(b)){for(var f in a)b[f]||c.push(f);for(var g in b)a[g]||d.push(g)}return{added:c,removed:d}},g=function(a){if(null==a||"object"!=typeof a)return a;var b=a.constructor();for(var c in a)b[c]=a[c];return b},h=function(a,b,c,d){try{Object.defineProperty(a,b,{get:c,set:d,enumerable:!0,configurable:!0})}catch(e){try{Object.prototype.__defineGetter__.call(a,b,c),Object.prototype.__defineSetter__.call(a,b,d)}catch(f){throw new Error("watchJS error: browser not supported :/")}}},i=function(a,b,c){try{Object.defineProperty(a,b,{enumerable:!1,configurable:!0,writable:!1,value:c})}catch(d){a[b]=c}},j=function(){c(arguments[1])?k.apply(this,arguments):e(arguments[1])?l.apply(this,arguments):m.apply(this,arguments)},k=function(a,b,c,d){if("string"!=typeof a&&(a instanceof Object||e(a))){var f=[];if(e(a))for(var g=0;g<a.length;g++)f.push(g);else for(var h in a)f.push(h);l(a,f,b,c,d)}},l=function(a,b,c,d,f){if("string"!=typeof a&&(a instanceof Object||e(a)))for(var g in b)m(a,b[g],c,d,f)},m=function(a,b,d,f,g){"string"!=typeof a&&(a instanceof Object||e(a))&&(c(a[b])||(null!=a[b]&&(void 0===f||f>0)&&(void 0!==f&&f--,k(a[b],d,f)),q(a,b,d),g&&x(a,b,d,f)))},n=function(){c(arguments[1])?o.apply(this,arguments):e(arguments[1])?p.apply(this,arguments):v.apply(this,arguments)},o=function(a,b){if(!(a instanceof String)&&(a instanceof Object||e(a))){var c=[];if(e(a))for(var d=0;d<a.length;d++)c.push(d);else for(var f in a)c.push(f);p(a,c,b)}},p=function(a,b,c){for(var d in b)v(a,b[d],c)},q=function(b,c,d){var e=b[c];u(b,c),b.watchers||i(b,"watchers",{}),b.watchers[c]||(b.watchers[c]=[]);for(var f in b.watchers[c])if(b.watchers[c][f]===d)return;b.watchers[c].push(d);var g=function(){return e},j=function(f){var g=e;e=f,b[c]&&k(b[c],d),u(b,c),a.noMore||JSON.stringify(g)!==JSON.stringify(f)&&(r(b,c,"set",f,g),a.noMore=!1)};h(b,c,g,j)},r=function(a,b,c,e,f){if(b)for(var g in a.watchers[b])d(g)&&a.watchers[b][g].call(a,b,c,e||a[b],f);else for(var b in a)r(a,b,c,e,f)},s=["pop","push","reverse","shift","sort","slice","unshift"],t=function(a,b,c,d){i(a[b],d,function(){var e=c.apply(a[b],arguments);return m(a,a[b]),"slice"!==d&&r(a,b,d,arguments),e})},u=function(a,b){if(a[b]&&!(a[b]instanceof String)&&e(a[b]))for(var c,d=s.length;d--;)c=s[d],t(a,b,a[b][c],c)},v=function(a,b,c){for(var d in a.watchers[b]){var e=a.watchers[b][d];e==c&&a.watchers[b].splice(d,1)}y(a,b,c)},w=function(){for(var a in b){var c=b[a],d=f(c.obj[c.prop],c.actual);if(d.added.length||d.removed.length){if(d.added.length)for(var e in c.obj.watchers[c.prop])l(c.obj[c.prop],d.added,c.obj.watchers[c.prop][e],c.level-1,!0);r(c.obj,c.prop,"differentattr",d,c.actual)}c.actual=g(c.obj[c.prop])}},x=function(a,c,d,e){b.push({obj:a,prop:c,actual:g(a[c]),watcher:d,level:e})},y=function(a,c,d){for(var e in b){var f=b[e];f.obj==a&&f.prop==c&&f.watcher==d&&b.splice(e,1)}};return setInterval(w,50),a.watch=j,a.unwatch=n,a.callWatchers=r,a}),function(){var a,b=function(a,b){return function(){return a.apply(b,arguments)}},c=[].slice,d={}.hasOwnProperty,e=function(a,b){function c(){this.constructor=a}for(var e in b)d.call(b,e)&&(a[e]=b[e]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},f=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};a={},String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),a.Binding=function(){function d(c,d,e,f,g,h){var i,j,k,l;if(this.view=c,this.el=d,this.type=e,this.key=f,this.keypath=g,this.options=null!=h?h:{},this.update=b(this.update,this),this.unbind=b(this.unbind,this),this.bind=b(this.bind,this),this.publish=b(this.publish,this),this.sync=b(this.sync,this),this.set=b(this.set,this),this.eventHandler=b(this.eventHandler,this),this.formattedValue=b(this.formattedValue,this),!(this.binder=a.internalBinders[this.type]||this.view.binders[e])){l=this.view.binders;for(i in l)k=l[i],"*"!==i&&-1!==i.indexOf("*")&&(j=new RegExp("^"+i.replace("*",".+")+"$"),j.test(e)&&(this.binder=k,this.args=new RegExp("^"+i.replace("*","(.+)")+"$").exec(e),this.args.shift()))}this.binder||(this.binder=this.view.binders["*"]),this.binder instanceof Function&&(this.binder={routine:this.binder}),this.formatters=this.options.formatters||[],this.model=this.key?this.view.models[this.key]:this.view.models}return d.prototype.formattedValue=function(a){var b,d,e,f,g,h;for(h=this.formatters,f=0,g=h.length;g>f;f++)d=h[f],b=d.split(/\s+/),e=b.shift(),d=this.model[e]instanceof Function?this.model[e]:this.view.formatters[e],(null!=d?d.read:void 0)instanceof Function?a=d.read.apply(d,[a].concat(c.call(b))):d instanceof Function&&(a=d.apply(null,[a].concat(c.call(b))));return a},d.prototype.eventHandler=function(a){var b,c;return c=(b=this).view.config.handler,function(d){return c.call(a,this,d,b)}},d.prototype.set=function(a){var b;return a=a instanceof Function&&!this.binder["function"]?this.formattedValue(a.call(this.model)):this.formattedValue(a),null!=(b=this.binder.routine)?b.call(this,this.el,a):void 0},d.prototype.sync=function(){return this.set(this.options.bypass?this.model[this.keypath]:this.view.config.adapter.read(this.model,this.keypath))},d.prototype.publish=function(){var b,d,e,f,g,h,i,j,k;for(f=a.Util.getInputValue(this.el),i=this.formatters.slice(0).reverse(),g=0,h=i.length;h>g;g++)d=i[g],b=d.split(/\s+/),e=b.shift(),(null!=(j=this.view.formatters[e])?j.publish:void 0)&&(f=(k=this.view.formatters[e]).publish.apply(k,[f].concat(c.call(b))));return this.view.config.adapter.publish(this.model,this.keypath,f)},d.prototype.bind=function(){var a,b,c,d,e,f,g,h,i;if(null!=(f=this.binder.bind)&&f.call(this,this.el),this.options.bypass?this.sync():(this.view.config.adapter.subscribe(this.model,this.keypath,this.sync),this.view.config.preloadData&&this.sync()),null!=(g=this.options.dependencies)?g.length:void 0){for(h=this.options.dependencies,i=[],d=0,e=h.length;e>d;d++)a=h[d],/^\./.test(a)?(c=this.model,b=a.substr(1)):(a=a.split("."),c=this.view.models[a.shift()],b=a.join(".")),i.push(this.view.config.adapter.subscribe(c,b,this.sync));return i}},d.prototype.unbind=function(){var a,b,c,d,e,f,g,h,i;if(null!=(f=this.binder.unbind)&&f.call(this,this.el),this.options.bypass||this.view.config.adapter.unsubscribe(this.model,this.keypath,this.sync),null!=(g=this.options.dependencies)?g.length:void 0){for(h=this.options.dependencies,i=[],d=0,e=h.length;e>d;d++)a=h[d],/^\./.test(a)?(c=this.model,b=a.substr(1)):(a=a.split("."),c=this.view.models[a.shift()],b=a.join(".")),i.push(this.view.config.adapter.unsubscribe(c,b,this.sync));return i}},d.prototype.update=function(a){var b;return null==a&&(a={}),this.key?a[this.key]&&(this.options.bypass||this.view.config.adapter.unsubscribe(this.model,this.keypath,this.sync),this.model=a[this.key],this.options.bypass?this.sync():(this.view.config.adapter.subscribe(this.model,this.keypath,this.sync),this.view.config.preloadData&&this.sync())):this.sync(),null!=(b=this.binder.update)?b.call(this,a):void 0},d}(),a.ComponentBinding=function(c){function d(c,d,e){var g,h,i,j,k;for(this.view=c,this.el=d,this.type=e,this.unbind=b(this.unbind,this),this.bind=b(this.bind,this),this.update=b(this.update,this),this.locals=b(this.locals,this),this.component=a.components[this.type],this.attributes={},this.inflections={},j=this.el.attributes||[],h=0,i=j.length;i>h;h++)g=j[h],k=g.name,f.call(this.component.attributes,k)>=0?this.attributes[g.name]=g.value:this.inflections[g.name]=g.value}return e(d,c),d.prototype.sync=function(){},d.prototype.locals=function(a){var b,c,d,e,f,g,h,i,j,k;null==a&&(a=this.view.models),f={},i=this.inflections;for(c in i)for(b=i[c],j=b.split("."),g=0,h=j.length;h>g;g++)e=j[g],f[c]=(f[c]||a)[e];for(c in a)d=a[c],null==(k=f[c])&&(f[c]=d);return f},d.prototype.update=function(a){var b;return null!=(b=this.componentView)?b.update(this.locals(a)):void 0},d.prototype.bind=function(){var b,c;return null!=this.componentView?null!=(c=this.componentView)?c.bind():void 0:(b=this.component.build.call(this.attributes),(this.componentView=new a.View(b,this.locals(),this.view.options)).bind(),this.el.parentNode.replaceChild(b,this.el))},d.prototype.unbind=function(){var a;return null!=(a=this.componentView)?a.unbind():void 0},d}(a.Binding),a.View=function(){function d(c,d,e){var f,g,h,i,j,k,l,m,n,o;for(this.els=c,this.models=d,this.options=null!=e?e:{},this.update=b(this.update,this),this.publish=b(this.publish,this),this.sync=b(this.sync,this),this.unbind=b(this.unbind,this),this.bind=b(this.bind,this),this.select=b(this.select,this),this.build=b(this.build,this),this.componentRegExp=b(this.componentRegExp,this),this.bindingRegExp=b(this.bindingRegExp,this),this.els.jquery||this.els instanceof Array||(this.els=[this.els]),l=["config","binders","formatters"],j=0,k=l.length;k>j;j++){if(g=l[j],this[g]={},this.options[g]){m=this.options[g];for(f in m)h=m[f],this[g][f]=h}n=a[g];for(f in n)h=n[f],null==(o=(i=this[g])[f])&&(i[f]=h)}this.build()}return d.prototype.bindingRegExp=function(){var a;return a=this.config.prefix,a?new RegExp("^data-"+a+"-"):/^data-/},d.prototype.componentRegExp=function(){var a,b;return new RegExp("^"+(null!=(a=null!=(b=this.config.prefix)?b.toUpperCase():void 0)?a:"RV")+"-")},d.prototype.build=function(){var b,d,e,g,h,i,j,k,l,m=this;for(this.bindings=[],i=[],b=this.bindingRegExp(),e=this.componentRegExp(),d=function(b,c,d){var e,f,g,h,i,j,k,l,n,o;return j={},n=function(){var a,b,c,e;for(c=d.split("|"),e=[],a=0,b=c.length;b>a;a++)l=c[a],e.push(l.trim());return e}(),e=function(){var a,b,c,d;for(c=n.shift().split("<"),d=[],a=0,b=c.length;b>a;a++)f=c[a],d.push(f.trim());return d}(),k=e.shift(),o=k.split(/\.|:/),j.formatters=n,j.bypass=-1!==k.indexOf(":"),o[0]?h=o.shift():(h=null,o.shift()),i=o.join("."),(g=e.shift())&&(j.dependencies=g.split(/\s+/)),m.bindings.push(new a.Binding(m,b,c,h,i,j))},h=function(g){var j,k,l,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P;if(f.call(i,g)<0){if(g.nodeType===Node.TEXT_NODE){if(r=a.TextTemplateParser,(o=m.config.templateDelimiters)&&(x=r.parse(g.data,o)).length&&(1!==x.length||x[0].type!==r.types.text)){switch(u=x[0],t=2<=x.length?c.call(x,1):[],g.data=u.value,u.type){case 0:g.data=u.value;break;case 1:d(g,"textNode",u.value)}for(A=0,E=t.length;E>A;A++)w=t[A],g.parentNode.appendChild(v=document.createTextNode(w.value)),1===w.type&&d(v,"textNode",w.value)}}else if(e.test(g.tagName))y=g.tagName.replace(e,"").toLowerCase(),m.bindings.push(new a.ComponentBinding(m,g,y));else if(null!=g.attributes){for(K=g.attributes,B=0,F=K.length;F>B;B++)if(j=K[B],b.test(j.name)){if(y=j.name.replace(b,""),!(l=m.binders[y])){L=m.binders;for(p in L)z=L[p],"*"!==p&&-1!==p.indexOf("*")&&(s=new RegExp("^"+p.replace("*",".+")+"$"),s.test(y)&&(l=z))}if(l||(l=m.binders["*"]),l.block){for(M=g.childNodes,C=0,G=M.length;G>C;C++)q=M[C],i.push(q);k=[j]}}for(N=k||g.attributes,D=0,H=N.length;H>D;D++)j=N[D],b.test(j.name)&&(y=j.name.replace(b,""),d(g,y,j.value))}for(O=g.childNodes,P=[],J=0,I=O.length;I>J;J++)n=O[J],P.push(h(n));return P}},l=this.els,j=0,k=l.length;k>j;j++)g=l[j],h(g)},d.prototype.select=function(a){var b,c,d,e,f;for(e=this.bindings,f=[],c=0,d=e.length;d>c;c++)b=e[c],a(b)&&f.push(b);return f},d.prototype.bind=function(){var a,b,c,d,e;for(d=this.bindings,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(a.bind());return e},d.prototype.unbind=function(){var a,b,c,d,e;for(d=this.bindings,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(a.unbind());return e},d.prototype.sync=function(){var a,b,c,d,e;for(d=this.bindings,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(a.sync());return e},d.prototype.publish=function(){var a,b,c,d,e;for(d=this.select(function(a){return a.binder.publishes}),e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(a.publish());return e},d.prototype.update=function(a){var b,c,d,e,f,g,h;null==a&&(a={});for(c in a)d=a[c],this.models[c]=d;for(g=this.bindings,h=[],e=0,f=g.length;f>e;e++)b=g[e],h.push(b.update(a));return h},d}(),a.TextTemplateParser=function(){function a(){}return a.types={text:0,binding:1},a.parse=function(a,b){var c,d,e,f,g,h,i;for(h=[],f=a.length,c=0,d=0;f>d;){if(c=a.indexOf(b[0],d),0>c){h.push({type:this.types.text,value:a.slice(d)});break}if(c>0&&c>d&&h.push({type:this.types.text,value:a.slice(d,c)}),d=c+2,c=a.indexOf(b[1],d),0>c){g=a.slice(d-2),e=h[h.length-1],(null!=e?e.type:void 0)===this.types.text?e.value+=g:h.push({type:this.types.text,value:g});break}i=a.slice(d,c).trim(),h.push({type:this.types.binding,value:i}),d=c+2}return h},a}(),a.Util={bindEvent:function(a,b,c){return null!=window.jQuery?(a=jQuery(a),null!=a.on?a.on(b,c):a.bind(b,c)):null!=window.addEventListener?a.addEventListener(b,c,!1):(b="on"+b,a.attachEvent(b,c))},unbindEvent:function(a,b,c){return null!=window.jQuery?(a=jQuery(a),null!=a.off?a.off(b,c):a.unbind(b,c)):null!=window.removeEventListener?a.removeEventListener(b,c,!1):(b="on"+b,a.detachEvent(b,c))},getInputValue:function(a){var b,c,d,e;if(null!=window.jQuery)switch(a=jQuery(a),a[0].type){case"checkbox":return a.is(":checked");default:return a.val()}else switch(a.type){case"checkbox":return a.checked;case"select-multiple":for(e=[],c=0,d=a.length;d>c;c++)b=a[c],b.selected&&e.push(b.value);return e;default:return a.value}}},a.binders={enabled:function(a,b){return a.disabled=!b},disabled:function(a,b){return a.disabled=!!b},checked:{publishes:!0,bind:function(b){return a.Util.bindEvent(b,"change",this.publish)},unbind:function(b){return a.Util.unbindEvent(b,"change",this.publish)},routine:function(a,b){var c;return a.checked="radio"===a.type?(null!=(c=a.value)?c.toString():void 0)===(null!=b?b.toString():void 0):!!b}},unchecked:{publishes:!0,bind:function(b){return a.Util.bindEvent(b,"change",this.publish)},unbind:function(b){return a.Util.unbindEvent(b,"change",this.publish)},routine:function(a,b){var c;return a.checked="radio"===a.type?(null!=(c=a.value)?c.toString():void 0)!==(null!=b?b.toString():void 0):!b}},show:function(a,b){return a.style.display=b?"":"none"},hide:function(a,b){return a.style.display=b?"none":""},html:function(a,b){return a.innerHTML=null!=b?b:""},value:{publishes:!0,bind:function(b){return a.Util.bindEvent(b,"change",this.publish)},unbind:function(b){return a.Util.unbindEvent(b,"change",this.publish)},routine:function(a,b){var c,d,e,g,h,i,j;if(null!=window.jQuery){if(a=jQuery(a),(null!=b?b.toString():void 0)!==(null!=(g=a.val())?g.toString():void 0))return a.val(null!=b?b:"")}else if("select-multiple"===a.type){if(null!=b){for(j=[],d=0,e=a.length;e>d;d++)c=a[d],j.push(c.selected=(h=c.value,f.call(b,h)>=0));return j}}else if((null!=b?b.toString():void 0)!==(null!=(i=a.value)?i.toString():void 0))return a.value=null!=b?b:""}},text:function(a,b){return null!=a.innerText?a.innerText=null!=b?b:"":a.textContent=null!=b?b:""},"if":{block:!0,bind:function(a){var b,c;return null==this.marker?(b=["data",this.view.config.prefix,this.type].join("-").replace("--","-"),c=a.getAttribute(b),this.marker=document.createComment(" rivets: "+this.type+" "+c+" "),a.removeAttribute(b),a.parentNode.insertBefore(this.marker,a),a.parentNode.removeChild(a)):void 0},unbind:function(){var a;return null!=(a=this.nested)?a.unbind():void 0},routine:function(b,c){var d,e,f,g,h;if(!!c==(null==this.nested)){if(c){f={},h=this.view.models;for(d in h)e=h[d],f[d]=e;return g={binders:this.view.options.binders,formatters:this.view.options.formatters,config:this.view.options.config},(this.nested=new a.View(b,f,g)).bind(),this.marker.parentNode.insertBefore(b,this.marker.nextSibling)}return b.parentNode.removeChild(b),this.nested.unbind(),delete this.nested}},update:function(a){return this.nested.update(a)}},unless:{block:!0,bind:function(b){return a.binders["if"].bind.call(this,b)},unbind:function(){return a.binders["if"].unbind.call(this)},routine:function(b,c){return a.binders["if"].routine.call(this,b,!c)},update:function(b){return a.binders["if"].update.call(this,b)}},"on-*":{"function":!0,unbind:function(b){return this.handler?a.Util.unbindEvent(b,this.args[0],this.handler):void 0},routine:function(b,c){return this.handler&&a.Util.unbindEvent(b,this.args[0],this.handler),a.Util.bindEvent(b,this.args[0],this.handler=this.eventHandler(c))}},"each-*":{block:!0,bind:function(a){var b;return null==this.marker?(b=["data",this.view.config.prefix,this.type].join("-").replace("--","-"),this.marker=document.createComment(" rivets: "+this.type+" "),this.iterated=[],a.removeAttribute(b),a.parentNode.insertBefore(this.marker,a),a.parentNode.removeChild(a)):void 0},unbind:function(){var a,b,c,d,e;if(null!=this.iterated){for(d=this.iterated,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(a.unbind());return e}},routine:function(b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x;if(j=this.args[0],c=c||[],this.iterated.length>c.length)for(t=Array(this.iterated.length-c.length),p=0,r=t.length;r>p;p++)e=t[p],o=this.iterated.pop(),o.unbind(),this.marker.parentNode.removeChild(o.els[0]);for(x=[],f=q=0,s=c.length;s>q;f=++q)if(i=c[f],d={},d[j]=i,null==this.iterated[f]){u=this.view.models;for(h in u)i=u[h],null==(v=d[h])&&(d[h]=i);l=this.iterated.length?this.iterated[this.iterated.length-1].els[0]:this.marker,k={binders:this.view.options.binders,formatters:this.view.options.formatters,config:{}},w=this.view.options.config;for(g in w)n=w[g],k.config[g]=n;k.config.preloadData=!0,m=b.cloneNode(!0),o=new a.View(m,d,k),o.bind(),this.iterated.push(o),x.push(this.marker.parentNode.insertBefore(m,l.nextSibling))}else this.iterated[f].models[j]!==i?x.push(this.iterated[f].update(d)):x.push(void 0);return x},update:function(a){var b,c,d,e,f,g,h,i;b={};for(c in a)d=a[c],c!==this.args[0]&&(b[c]=d);for(h=this.iterated,i=[],f=0,g=h.length;g>f;f++)e=h[f],i.push(e.update(b));return i}},"class-*":function(a,b){var c;return c=" "+a.className+" ",!b==(-1!==c.indexOf(" "+this.args[0]+" "))?a.className=b?""+a.className+" "+this.args[0]:c.replace(" "+this.args[0]+" "," ").trim():void 0},"*":function(a,b){return b?a.setAttribute(this.type,b):a.removeAttribute(this.type)}},a.internalBinders={textNode:function(a,b){return a.data=null!=b?b:""}},a.components={},a.config={preloadData:!0,handler:function(a,b,c){return this.call(a,b,c.view.models)}},a.formatters={},a.factory=function(b){return b._=a,b.binders=a.binders,b.components=a.components,b.formatters=a.formatters,b.config=a.config,b.configure=function(b){var c,d;null==b&&(b={});for(c in b)d=b[c],a.config[c]=d},b.bind=function(b,c,d){var e;return null==c&&(c={}),null==d&&(d={}),e=new a.View(b,c,d),e.bind(),e}},"object"==typeof exports?a.factory(exports):"function"==typeof define&&define.amd?define(["exports"],function(b){return a.factory(this.rivets=b),b}):a.factory(this.rivets={})}.call(this),function(a,b,c){if(!a)return console.error("Witch: where is jQuery?");if(!b)return console.error("Witch: where is Rivets?");if(!c)return console.error("Witch: where is WatchJS?");var d=function(a){return function(b,c,d){c=c.split("."),a(b,c[0],d,c.length-1)}},e=function(a,b,c){if(!b)return a;for(var d=b.split(".");d.length>1&&(a=a[d.shift()],void 0!=a););return 2===arguments.length?a[d.shift()]:(a[d.shift()]=c,void 0)};b.configure({adapter:{subscribe:d(c.watch),unsubscribe:d(c.unwatch),read:e,publish:e},handler:function(b,c,d){return a(b).data("default")||c.preventDefault(),this.call(d.model,d)}});var f=function(b,c,d,e,f){return d=d?"get"==b?a.param(d):JSON.stringify(d):null,a.ajax({type:b,url:c,data:d,success:e,dataType:"json",processData:!1,contentType:"application/json",context:f})},g=function(a,b){this._collection=b||this._collection,this._callback=this._callback.bind(this),this.update(a)};g.prototype={_parse:function(a){return a},_callback:function(b){b=this._parse(b),!this._id&&b._id&&this._collection&&(this._collection.byId[b._id]=this),a.extend(this,b)},_clean:function(){var a;for(a in this)this.hasOwnProperty(a)&&"_"!=a[0]&&(this[a]="")},toJSON:function(){var a,b={};for(a in this)this.hasOwnProperty(a)&&"_"!=a[0]&&(b[a]=this[a]);return b},fetch:function(a){return f("get",this._url+this._id,a,this._callback)},save:function(){return f(this._id?"put":"post",this._url+this._id,this,this._callback)},saveAs:function(){var a=this.toJSON();return this._clean(),this._collection.push(a).save()},"delete":function(){return this._id?f("delete",this._url+this._id,{},function(){this._clean(),this._destroyed=!0},this):(this._clean(),this._destroyed=!0,void 0)},update:function(b){return a.extend(this,this._parse(b)),this}};var h=function(a,b,c){"string"==typeof b&&(c=b,b=null),this.model=b||this.model||g,this.url=c||this.url||this.model.prototype._url,this.clean(),a&&this.push(a)};h.prototype={clean:function(){return this.list=[],this.byId={},this},fetch:function(a){return f("get",this.url,a,function(a){this.push(a)}.bind(this))},push:function(a){return Array.isArray(a)?(a.forEach(this.push.bind(this)),this.filled=!0,!1):this.byId[a._id]?this.byId[a._id].update(a):(a=a instanceof g?a:new this.model(a,this),a._collection=this,a._url||(a._url=this.url),this.filled&&(a._new=!0),c.watch(a,"_destroyed",function(b,c,d){d&&this.remove(a)}.bind(this)),a._id&&(this.byId[a._id]=a),this.list.push(a),a)},remove:function(a){var b=this.list.indexOf(a);-1!==b&&this.list.splice(b,1),delete this.byId[a._id],c.callWatchers(this)}};var i=function(b,c){this.template||(this.template=c),this.data=a.extend({},this.data,b),this.data.tpl=this};i.prototype={render:function(a){return this.template?(arguments.length||(a=this.ready),witch.config.template(this.template,this.data,function(c,d){this.el=d,this._rivets=b.bind(this.el,this.data),a&&a.call(this)}.bind(this)),this):console.error("No template",this)}},window.witch={Model:g,Collection:h,Template:i,rest:f,config:{auto:!0,template:function(b,c,d){var e=a(a('[data-template="'+b+'"]').html().trim());d(!e.length,e)}},init:function(){a("[data-rivets]").each(function(){var c=a(this),d=window[c.data("rivets")];d&&!d._rivets&&(d._rivets=b.bind(c,d))})},inherit:function(){var b=Array.prototype.slice.call(arguments),c=b[0],d=function(){c.apply(this,arguments)};return b.unshift(d),a.extend.apply(this,b.map(function(a){return"function"==typeof a?a.prototype:a})),d}},a(function(){witch.config.auto&&witch.init()})}($||jQuery,rivets,WatchJS);