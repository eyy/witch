"use strict";!function(a){"object"==typeof exports?module.exports=a():"function"==typeof define&&define.amd?define(a):(window.WatchJS=a(),window.watch=window.WatchJS.watch,window.unwatch=window.WatchJS.unwatch,window.callWatchers=window.WatchJS.callWatchers)}(function(){var a={noMore:!1},b=[],c=function(a){var b={};return a&&"[object Function]"==b.toString.call(a)},d=function(a){return 0===a%1},e=function(a){return"[object Array]"===Object.prototype.toString.call(a)},f=function(a,b){var c=[],d=[];if("string"!=typeof a&&"string"!=typeof b&&!e(a)&&!e(b)){for(var f in a)b[f]||c.push(f);for(var g in b)a[g]||d.push(g)}return{added:c,removed:d}},g=function(a){if(null==a||"object"!=typeof a)return a;var b=a.constructor();for(var c in a)b[c]=a[c];return b},h=function(a,b,c,d){try{Object.defineProperty(a,b,{get:c,set:d,enumerable:!0,configurable:!0})}catch(e){try{Object.prototype.__defineGetter__.call(a,b,c),Object.prototype.__defineSetter__.call(a,b,d)}catch(f){throw new Error("watchJS error: browser not supported :/")}}},i=function(a,b,c){try{Object.defineProperty(a,b,{enumerable:!1,configurable:!0,writable:!1,value:c})}catch(d){a[b]=c}},j=function(){c(arguments[1])?k.apply(this,arguments):e(arguments[1])?l.apply(this,arguments):m.apply(this,arguments)},k=function(a,b,c,d){if("string"!=typeof a&&(a instanceof Object||e(a))){var f=[];if(e(a))for(var g=0;g<a.length;g++)f.push(g);else for(var h in a)f.push(h);l(a,f,b,c,d)}},l=function(a,b,c,d,f){if("string"!=typeof a&&(a instanceof Object||e(a)))for(var g in b)m(a,b[g],c,d,f)},m=function(a,b,d,f,g){"string"!=typeof a&&(a instanceof Object||e(a))&&(c(a[b])||(null!=a[b]&&(void 0===f||f>0)&&(void 0!==f&&f--,k(a[b],d,f)),q(a,b,d),g&&x(a,b,d,f)))},n=function(){c(arguments[1])?o.apply(this,arguments):e(arguments[1])?p.apply(this,arguments):v.apply(this,arguments)},o=function(a,b){if(!(a instanceof String)&&(a instanceof Object||e(a))){var c=[];if(e(a))for(var d=0;d<a.length;d++)c.push(d);else for(var f in a)c.push(f);p(a,c,b)}},p=function(a,b,c){for(var d in b)v(a,b[d],c)},q=function(b,c,d){var e=b[c];u(b,c),b.watchers||i(b,"watchers",{}),b.watchers[c]||(b.watchers[c]=[]);for(var f in b.watchers[c])if(b.watchers[c][f]===d)return;b.watchers[c].push(d);var g=function(){return e},j=function(f){var g=e;e=f,b[c]&&k(b[c],d),u(b,c),a.noMore||JSON.stringify(g)!==JSON.stringify(f)&&(r(b,c,"set",f,g),a.noMore=!1)};h(b,c,g,j)},r=function(a,b,c,e,f){if(b)for(var g in a.watchers[b])d(g)&&a.watchers[b][g].call(a,b,c,e||a[b],f);else for(var b in a)r(a,b,c,e,f)},s=["pop","push","reverse","shift","sort","slice","unshift"],t=function(a,b,c,d){i(a[b],d,function(){var e=c.apply(a[b],arguments);return m(a,a[b]),"slice"!==d&&r(a,b,d,arguments),e})},u=function(a,b){if(a[b]&&!(a[b]instanceof String)&&e(a[b]))for(var c,d=s.length;d--;)c=s[d],t(a,b,a[b][c],c)},v=function(a,b,c){for(var d in a.watchers[b]){var e=a.watchers[b][d];e==c&&a.watchers[b].splice(d,1)}y(a,b,c)},w=function(){for(var a in b){var c=b[a],d=f(c.obj[c.prop],c.actual);if(d.added.length||d.removed.length){if(d.added.length)for(var e in c.obj.watchers[c.prop])l(c.obj[c.prop],d.added,c.obj.watchers[c.prop][e],c.level-1,!0);r(c.obj,c.prop,"differentattr",d,c.actual)}c.actual=g(c.obj[c.prop])}},x=function(a,c,d,e){b.push({obj:a,prop:c,actual:g(a[c]),watcher:d,level:e})},y=function(a,c,d){for(var e in b){var f=b[e];f.obj==a&&f.prop==c&&f.watcher==d&&b.splice(e,1)}};return setInterval(w,50),a.watch=j,a.unwatch=n,a.callWatchers=r,a}),function(){var a,b=function(a,b){return function(){return a.apply(b,arguments)}},c=[].slice,d=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};a={},String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),a.Binding=function(){function d(a,c,d,e,f,g){var h,i,j,k;if(this.view=a,this.el=c,this.type=d,this.key=e,this.keypath=f,this.options=null!=g?g:{},this.update=b(this.update,this),this.unbind=b(this.unbind,this),this.bind=b(this.bind,this),this.publish=b(this.publish,this),this.sync=b(this.sync,this),this.set=b(this.set,this),this.eventHandler=b(this.eventHandler,this),this.formattedValue=b(this.formattedValue,this),!(this.binder=this.view.binders[d])){k=this.view.binders;for(h in k)j=k[h],"*"!==h&&-1!==h.indexOf("*")&&(i=new RegExp("^"+h.replace("*",".+")+"$"),i.test(d)&&(this.binder=j,this.args=new RegExp("^"+h.replace("*","(.+)")+"$").exec(d),this.args.shift()))}this.binder||(this.binder=this.view.binders["*"]),this.binder instanceof Function&&(this.binder={routine:this.binder}),this.formatters=this.options.formatters||[],this.model=this.key?this.view.models[this.key]:this.view.models}return d.prototype.formattedValue=function(a){var b,d,e,f,g,h;for(h=this.formatters,f=0,g=h.length;g>f;f++)d=h[f],b=d.split(/\s+/),e=b.shift(),d=this.model[e]instanceof Function?this.model[e]:this.view.formatters[e],(null!=d?d.read:void 0)instanceof Function?a=d.read.apply(d,[a].concat(c.call(b))):d instanceof Function&&(a=d.apply(null,[a].concat(c.call(b))));return a},d.prototype.eventHandler=function(a){var b,c;return c=(b=this).view.config.handler,function(d){return c.call(a,this,d,b)}},d.prototype.set=function(a){var b;return a=a instanceof Function&&!this.binder["function"]?this.formattedValue(a.call(this.model)):this.formattedValue(a),null!=(b=this.binder.routine)?b.call(this,this.el,a):void 0},d.prototype.sync=function(){return this.set(this.options.bypass?this.model[this.keypath]:this.view.config.adapter.read(this.model,this.keypath))},d.prototype.publish=function(){var b,d,e,f,g,h,i,j,k;for(f=a.Util.getInputValue(this.el),i=this.formatters.slice(0).reverse(),g=0,h=i.length;h>g;g++)d=i[g],b=d.split(/\s+/),e=b.shift(),(null!=(j=this.view.formatters[e])?j.publish:void 0)&&(f=(k=this.view.formatters[e]).publish.apply(k,[f].concat(c.call(b))));return this.view.config.adapter.publish(this.model,this.keypath,f)},d.prototype.bind=function(){var a,b,c,d,e,f,g,h,i;if(null!=(f=this.binder.bind)&&f.call(this,this.el),this.options.bypass?this.sync():(this.view.config.adapter.subscribe(this.model,this.keypath,this.sync),this.view.config.preloadData&&this.sync()),null!=(g=this.options.dependencies)?g.length:void 0){for(h=this.options.dependencies,i=[],d=0,e=h.length;e>d;d++)a=h[d],/^\./.test(a)?(c=this.model,b=a.substr(1)):(a=a.split("."),c=this.view.models[a.shift()],b=a.join(".")),i.push(this.view.config.adapter.subscribe(c,b,this.sync));return i}},d.prototype.unbind=function(){var a,b,c,d,e,f,g,h,i;if(null!=(f=this.binder.unbind)&&f.call(this,this.el),this.options.bypass||this.view.config.adapter.unsubscribe(this.model,this.keypath,this.sync),null!=(g=this.options.dependencies)?g.length:void 0){for(h=this.options.dependencies,i=[],d=0,e=h.length;e>d;d++)a=h[d],/^\./.test(a)?(c=this.model,b=a.substr(1)):(a=a.split("."),c=this.view.models[a.shift()],b=a.join(".")),i.push(this.view.config.adapter.unsubscribe(c,b,this.sync));return i}},d.prototype.update=function(a){var b;return null==a&&(a={}),this.key?a[this.key]&&(this.options.bypass||this.view.config.adapter.unsubscribe(this.model,this.keypath,this.sync),this.model=a[this.key],this.options.bypass?this.sync():(this.view.config.adapter.subscribe(this.model,this.keypath,this.sync),this.view.config.preloadData&&this.sync())):this.sync(),null!=(b=this.binder.update)?b.call(this,a):void 0},d}(),a.View=function(){function c(c,d,e){var f,g,h,i,j,k,l,m,n,o;for(this.els=c,this.models=d,this.options=null!=e?e:{},this.update=b(this.update,this),this.publish=b(this.publish,this),this.sync=b(this.sync,this),this.unbind=b(this.unbind,this),this.bind=b(this.bind,this),this.select=b(this.select,this),this.build=b(this.build,this),this.bindingRegExp=b(this.bindingRegExp,this),this.els.jquery||this.els instanceof Array||(this.els=[this.els]),l=["config","binders","formatters"],j=0,k=l.length;k>j;j++){if(g=l[j],this[g]={},this.options[g]){m=this.options[g];for(f in m)h=m[f],this[g][f]=h}n=a[g];for(f in n)h=n[f],null==(o=(i=this[g])[f])&&(i[f]=h)}this.build()}return c.prototype.bindingRegExp=function(){var a;return a=this.config.prefix,a?new RegExp("^data-"+a+"-"):/^data-/},c.prototype.build=function(){var b,c,e,f,g,h,i,j,k,l,m,n=this;for(this.bindings=[],g=[],b=this.bindingRegExp(),f=function(c){var e,f,h,i,j,k,l,m,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H;if(d.call(g,c)<0){for(E=c.attributes,y=0,B=E.length;B>y;y++)if(e=E[y],b.test(e.name)){if(w=e.name.replace(b,""),!(h=n.binders[w])){F=n.binders;for(l in F)x=F[l],"*"!==l&&-1!==l.indexOf("*")&&(u=new RegExp("^"+l.replace("*",".+")+"$"),u.test(w)&&(h=x))}if(h||(h=n.binders["*"]),h.block){for(G=c.getElementsByTagName("*"),z=0,C=G.length;C>z;z++)p=G[z],g.push(p);f=[e]}}for(H=f||c.attributes,A=0,D=H.length;D>A;A++)e=H[A],b.test(e.name)&&(q={},w=e.name.replace(b,""),t=function(){var a,b,c,d;for(c=e.value.split("|"),d=[],a=0,b=c.length;b>a;a++)s=c[a],d.push(s.trim());return d}(),i=function(){var a,b,c,d;for(c=t.shift().split("<"),d=[],a=0,b=c.length;b>a;a++)j=c[a],d.push(j.trim());return d}(),r=i.shift(),v=r.split(/\.|:/),q.formatters=t,q.bypass=-1!==r.indexOf(":"),v[0]?m=v.shift():(m=null,v.shift()),o=v.join("."),m&&null==n.models[m]||((k=i.shift())&&(q.dependencies=k.split(/\s+/)),n.bindings.push(new a.Binding(n,c,w,m,o,q))));f&&(f=null)}},l=this.els,h=0,j=l.length;j>h;h++)for(c=l[h],f(c),m=c.getElementsByTagName("*"),i=0,k=m.length;k>i;i++)e=m[i],null!=e.attributes&&f(e)},c.prototype.select=function(a){var b,c,d,e,f;for(e=this.bindings,f=[],c=0,d=e.length;d>c;c++)b=e[c],a(b)&&f.push(b);return f},c.prototype.bind=function(){var a,b,c,d,e;for(d=this.bindings,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(a.bind());return e},c.prototype.unbind=function(){var a,b,c,d,e;for(d=this.bindings,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(a.unbind());return e},c.prototype.sync=function(){var a,b,c,d,e;for(d=this.bindings,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(a.sync());return e},c.prototype.publish=function(){var a,b,c,d,e;for(d=this.select(function(a){return a.binder.publishes}),e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(a.publish());return e},c.prototype.update=function(a){var b,c,d,e,f,g,h;null==a&&(a={});for(c in a)d=a[c],this.models[c]=d;for(g=this.bindings,h=[],e=0,f=g.length;f>e;e++)b=g[e],h.push(b.update(a));return h},c}(),a.Util={bindEvent:function(a,b,c){return null!=window.jQuery?(a=jQuery(a),null!=a.on?a.on(b,c):a.bind(b,c)):null!=window.addEventListener?a.addEventListener(b,c,!1):(b="on"+b,a.attachEvent(b,c))},unbindEvent:function(a,b,c){return null!=window.jQuery?(a=jQuery(a),null!=a.off?a.off(b,c):a.unbind(b,c)):null!=window.removeEventListener?a.removeEventListener(b,c,!1):(b="on"+b,a.detachEvent(b,c))},getInputValue:function(a){var b,c,d,e;if(null!=window.jQuery)switch(a=jQuery(a),a[0].type){case"checkbox":return a.is(":checked");default:return a.val()}else switch(a.type){case"checkbox":return a.checked;case"select-multiple":for(e=[],c=0,d=a.length;d>c;c++)b=a[c],b.selected&&e.push(b.value);return e;default:return a.value}}},a.binders={enabled:function(a,b){return a.disabled=!b},disabled:function(a,b){return a.disabled=!!b},checked:{publishes:!0,bind:function(b){return a.Util.bindEvent(b,"change",this.publish)},unbind:function(b){return a.Util.unbindEvent(b,"change",this.publish)},routine:function(a,b){var c;return a.checked="radio"===a.type?(null!=(c=a.value)?c.toString():void 0)===(null!=b?b.toString():void 0):!!b}},unchecked:{publishes:!0,bind:function(b){return a.Util.bindEvent(b,"change",this.publish)},unbind:function(b){return a.Util.unbindEvent(b,"change",this.publish)},routine:function(a,b){var c;return a.checked="radio"===a.type?(null!=(c=a.value)?c.toString():void 0)!==(null!=b?b.toString():void 0):!b}},show:function(a,b){return a.style.display=b?"":"none"},hide:function(a,b){return a.style.display=b?"none":""},html:function(a,b){return a.innerHTML=null!=b?b:""},value:{publishes:!0,bind:function(b){return a.Util.bindEvent(b,"change",this.publish)},unbind:function(b){return a.Util.unbindEvent(b,"change",this.publish)},routine:function(a,b){var c,e,f,g,h,i,j;if(null!=window.jQuery){if(a=jQuery(a),(null!=b?b.toString():void 0)!==(null!=(g=a.val())?g.toString():void 0))return a.val(null!=b?b:"")}else if("select-multiple"===a.type){if(null!=b){for(j=[],e=0,f=a.length;f>e;e++)c=a[e],j.push(c.selected=(h=c.value,d.call(b,h)>=0));return j}}else if((null!=b?b.toString():void 0)!==(null!=(i=a.value)?i.toString():void 0))return a.value=null!=b?b:""}},text:function(a,b){return null!=a.innerText?a.innerText=null!=b?b:"":a.textContent=null!=b?b:""},"if":{block:!0,bind:function(a){var b,c;return null==this.marker?(b=["data",this.view.config.prefix,this.type].join("-").replace("--","-"),c=a.getAttribute(b),this.marker=document.createComment(" rivets: "+this.type+" "+c+" "),a.removeAttribute(b),a.parentNode.insertBefore(this.marker,a),a.parentNode.removeChild(a)):void 0},unbind:function(){var a;return null!=(a=this.nested)?a.unbind():void 0},routine:function(b,c){var d,e,f,g,h;if(c===(null==this.nested)){if(c){f={},h=this.view.models;for(d in h)e=h[d],f[d]=e;return g={binders:this.view.options.binders,formatters:this.view.options.formatters,config:this.view.options.config},(this.nested=new a.View(b,f,g)).bind(),this.marker.parentNode.insertBefore(b,this.marker.nextSibling)}return b.parentNode.removeChild(b),this.nested.unbind(),delete this.nested}},update:function(a){return this.nested.update(a)}},unless:{block:!0,bind:function(b){return a.binders["if"].bind.call(this,b)},unbind:function(){return a.binders["if"].unbind.call(this)},routine:function(b,c){return a.binders["if"].routine.call(this,b,!c)},update:function(b){return a.binders["if"].update.call(this,b)}},"on-*":{"function":!0,unbind:function(b){return this.handler?a.Util.unbindEvent(b,this.args[0],this.handler):void 0},routine:function(b,c){return this.handler&&a.Util.unbindEvent(b,this.args[0],this.handler),a.Util.bindEvent(b,this.args[0],this.handler=this.eventHandler(c))}},"each-*":{block:!0,bind:function(a){var b;return null==this.marker?(b=["data",this.view.config.prefix,this.type].join("-").replace("--","-"),this.marker=document.createComment(" rivets: "+this.type+" "),this.iterated=[],a.removeAttribute(b),a.parentNode.insertBefore(this.marker,a),a.parentNode.removeChild(a)):void 0},unbind:function(){var a,b,c,d,e;if(null!=this.iterated){for(d=this.iterated,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(a.unbind());return e}},routine:function(b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x;if(j=this.args[0],c=c||[],this.iterated.length>c.length)for(t=Array(this.iterated.length-c.length),p=0,r=t.length;r>p;p++)e=t[p],o=this.iterated.pop(),o.unbind(),this.marker.parentNode.removeChild(o.els[0]);for(x=[],f=q=0,s=c.length;s>q;f=++q)if(i=c[f],d={},d[j]=i,null==this.iterated[f]){u=this.view.models;for(h in u)i=u[h],null==(v=d[h])&&(d[h]=i);l=this.iterated.length?this.iterated[this.iterated.length-1].els[0]:this.marker,k={binders:this.view.options.binders,formatters:this.view.options.formatters,config:{}},w=this.view.options.config;for(g in w)n=w[g],k.config[g]=n;k.config.preloadData=!0,m=b.cloneNode(!0),o=new a.View(m,d,k),o.bind(),this.iterated.push(o),x.push(this.marker.parentNode.insertBefore(m,l.nextSibling))}else this.iterated[f].models[j]!==i?x.push(this.iterated[f].update(d)):x.push(void 0);return x},update:function(a){var b,c,d,e,f,g,h,i;b={};for(c in a)d=a[c],c!==this.args[0]&&(b[c]=d);for(h=this.iterated,i=[],f=0,g=h.length;g>f;f++)e=h[f],i.push(e.update(b));return i}},"class-*":function(a,b){var c;return c=" "+a.className+" ",!b==(-1!==c.indexOf(" "+this.args[0]+" "))?a.className=b?""+a.className+" "+this.args[0]:c.replace(" "+this.args[0]+" "," ").trim():void 0},"*":function(a,b){return b?a.setAttribute(this.type,b):a.removeAttribute(this.type)}},a.config={preloadData:!0,handler:function(a,b,c){return this.call(a,b,c.view.models)}},a.formatters={},a.factory=function(b){return b.binders=a.binders,b.formatters=a.formatters,b.config=a.config,b.configure=function(b){var c,d;null==b&&(b={});for(c in b)d=b[c],a.config[c]=d},b.bind=function(b,c,d){var e;return null==c&&(c={}),null==d&&(d={}),e=new a.View(b,c,d),e.bind(),e}},"object"==typeof exports?a.factory(exports):"function"==typeof define&&define.amd?define(["exports"],function(b){return a.factory(this.rivets=b),b}):a.factory(this.rivets={})}.call(this),function(){var a=function(a){return function(b,c,d){c=c.split("."),a(b,c[0],d,c.length-1)}},b=function(a,b,c){if(!b)return a;for(var d=b.split(".");d.length>1&&(a=a[d.shift()],void 0!=a););return 2===arguments.length?a[d.shift()]:(a[d.shift()]=c,void 0)};rivets.configure({adapter:{subscribe:a(watch),unsubscribe:a(unwatch),read:b,publish:b},handler:function(a,b,c){return $(a).data("default")||b.preventDefault(),this.call(c.model,c)}})}(),function(){var a=[].slice,b=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=0|16*Math.random(),c="x"==a?b:8|3&b;return c.toString(16)})},c=function(a,b,c,d){return c=c?"get"==a?$.param(c):JSON.stringify(c):null,$.ajax({type:a,url:b,data:c,success:d,dataType:"json",processData:!1,contentType:"application/json"})};["get","post","put","delete"].forEach(function(a){c[a]=c.bind(c,a)});var d=function(a,b){this._collection=b||this._collection,$.extend(this,a)};$.extend(d.prototype,{_parse:function(a){return a},_callback:function(a){a=this._parse(a),!this._id&&this._collection&&this._collection.move(this,this._id),$.extend(this,a)},_clean:function(){var a;for(a in this)this.hasOwnProperty(a)&&"_"!=a[0]&&(this[a]="")},toJSON:function(){var a,b={};for(a in this)this.hasOwnProperty(a)&&"_"!=a[0]&&(b[a]=this[a]);return b},fetch:function(a){return c.get(this._url+this._id,a,this._callback.bind(this))},save:function(){return c[this._id?"put":"post"](this._url+this._id,this,this._callback.bind(this))},saveAs:function(){var a=this.toJSON();return this._clean(),this._collection.push(a).save()},"delete":function(){return this._id?c.delete(this._url+this._id,{},function(){this._clean(),this._destroyed=!0}.bind(this)):(this._clean(),this._destroyed=!0,void 0)}});var e=function(a,b,c){"string"==typeof b&&(c=b,b=null),this.model=b||this.model||d,this.url=c||this.url||this.model.prototype._url,this.clean(),a&&this.push(a)};$.extend(e.prototype,{clean:function(){return this.list=[],this.byId={},this},fetch:function(a){return c.get(this.url,a,function(a){this.push(a)}.bind(this))},push:function(a){return Array.isArray(a)?(a.forEach(this.push.bind(this)),this.filled=!0,!1):(a=a instanceof d?a:new this.model(a,this),a._collection=this,this.filled&&(a._new=!0),watch(a,"_destroyed",function(b,c,d){d&&this.remove(a)}.bind(this)),this.byId[a._id||b()]=a,this.list.push(a),a)},remove:function(a){this.list.splice(this.list.indexOf(a),1),callWatchers(this)}});var f=function(a,b){this.template||(this.template=b),this.data=$.extend({},this.data,a),this.data.tpl=this};$.extend(f.prototype,{render:function(a){return this.template?(a||(a=this.ready),witch.config.template(this.template,function(b,c){this.el=c,this.binding=rivets.bind(this.el,this.data),a&&a.call(this)}.bind(this)),this):console.error("No template",this)}}),window.witch={Model:d,Collection:e,Template:f,config:{template:function(a,b){var c=$('[data-template="'+a+'"] > :not(:empty)').clone();b(!c.length,c)},preload:!0},init:function(){$("[data-rivets]").each(function(){var a=$(this),b=window[a.data("rivets")];b&&(b._rivets=rivets.bind(a,b))})},inherit:function(){var b=a.call(arguments),c=b[0],d=function(){c.apply(this,arguments)};return b.unshift(d),$.extend.apply(this,b.map(function(a){return"function"==typeof a?a.prototype:a})),d},rest:c},$(function(){witch.config.preload&&witch.init()})}();